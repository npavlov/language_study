# Internationalization (i18n)

**File**: `src/js/i18n.js`

## Overview

All user-facing UI text is stored in `i18n.js` with translations for 3 languages: Russian (default), English, and Serbian. The active language is determined by the `uiLanguage` setting in localStorage.

Text is never hardcoded in mode/screen files — always imported from `i18n.js`.

## Imports

```js
import { t, fmt, langLabel, uiLang, fmtDate, fmtDuration } from '../i18n.js';
```

## Exports

| Export | Type | Description |
|--------|------|-------------|
| `t` | `Object` | Active language translation map — use as `t.key_name` |
| `uiLang` | `string` | Current UI language code (`'ru'`, `'en'`, or `'sr'`) |
| `fmt(key, vars)` | `Function` | Interpolate `{placeholder}` in translation string |
| `langLabel(lang)` | `Function` | Localized language name (e.g. `langLabel('en')` → `'Английский'` in RU) |
| `fmtDate(isoStr)` | `Function` | Format ISO date with localized month names |
| `fmtDuration(seconds)` | `Function` | Format seconds with localized time units |

## Language Selection

The UI language is stored in `settings.js` as `uiLanguage` (default: `'ru'`). At module load, `i18n.js` reads `localStorage` directly to select the active translation map. When the user changes language in the menu, `settings.js` is updated and the page reloads.

```js
// Language selector calls:
updateSettings({ uiLanguage: 'en' });
window.location.reload();
```

## String Map (`t`)

### Common
| Key | RU | EN | SR |
|-----|----|----|-----|
| `back_to_menu` | В меню | Menu | Meni |
| `session_complete` | Сессия завершена! | Session complete! | Sesija završena! |
| `round_complete` | Раунд завершён! | Round complete! | Runda završena! |
| `play_again` | Играть ещё | Play again | Igraj ponovo |
| `score` | Очки | Score | Poeni |
| `accuracy` | Точность | Accuracy | Tačnost |
| `time` | Время | Time | Vreme |
| `best_streak` | Лучшая серия | Best streak | Najbolji niz |
| `correct` | Правильно | Correct | Tačno |

### Flashcards
| Key | RU | EN | SR |
|-----|----|----|-----|
| `know` / `dont_know` | Знаю / Не знаю | Know / Don't know | Znam / Ne znam |
| `tap_to_reveal` | Нажми, чтобы увидеть подсказку | Tap to reveal hint | Tapni za pomoć |
| `tap_for_russian` | Нажми ещё для русской подсказки | Tap again for Russian hint | Tapni ponovo za ruski prevod |
| `known` / `unknown` | Знаю / Не знаю | Known / Unknown | Znam / Ne znam |
| `review_mistakes` | Повторить ошибки | Review mistakes | Ponovi greške |
| `done` | Готово | Done | Gotovo |

### Quiz
| Key | RU | EN | SR |
|-----|----|----|-----|
| `question` | Вопрос | Question | Pitanje |
| `final_score` | Итоговый счёт | Final score | Krajnji rezultat |
| `words_seen` | Слов всего | Words seen | Reči ukupno |
| `words_to_review` | Слова для повторения: | Words to review: | Reči za ponavljanje: |
| `perfect_round` | Идеальный раунд — без ошибок! | Perfect round — no mistakes! | Savršena runda — bez grešaka! |

### Typing
| Key | RU | EN | SR |
|-----|----|----|-----|
| `translate_to` | Переведи на | Translate to | Prevedi na |
| `type_translation` | Напиши перевод… | Type translation… | Napiši prevod… |
| `submit` | Ответ | Submit | Odgovor |
| `hint` / `no_more_hints` | Подсказка / Подсказок нет | Hint / No more hints | Pomoć / Nema više pomoći |
| `skip` / `next_word` | Пропустить / Дальше | Skip / Next | Preskoči / Dalje |
| `correct_answer` | Правильно! ✓ | Correct! ✓ | Tačno! ✓ |
| `answer_is` | Ответ: | Answer: | Odgovor: |
| `close_answer` | Почти! Ответ: | Close! Answer: | Blizu! Odgovor: |

### Match
| Key | RU | EN | SR |
|-----|----|----|-----|
| `round` | Раунд | Round | Runda |
| `wrong_attempts` | Ошибки | Wrong | Greške |
| `pairs_matched` | Пар найдено | Pairs matched | Parova spojeno |
| `next_round` | Следующий раунд | Next round | Sledeća runda |

### Menu / Settings
| Key | RU | EN | SR |
|-----|----|----|-----|
| `words_available` | слов доступно | words available | reči dostupno |
| `repeat_forgotten` | Повторять забытые слова | Repeat forgotten words | Ponavljaj zaboravljene reči |
| `ui_language` | Язык интерфейса | Interface language | Jezik interfejsa |
| `start` / `loading` | Начать / Загрузка… | Start / Loading… | Počni / Učitavanje… |
| `app_subtitle` | Учи английский и сербский в игровой форме | Learn English and Serbian through games | Uči engleski i srpski kroz igre |
| `tab_game` / `tab_stats` / `tab_words` | Игра / Статистика / Слова | Game / Stats / Words | Igra / Statistika / Reči |

### Language Labels
| Key | RU | EN | SR |
|-----|----|----|-----|
| `lang_en` | Английский | English | Engleski |
| `lang_sr` | Сербский | Serbian | Srpski |
| `lang_ru` | Русский | Russian | Ruski |

## `fmt(key, vars)` — Interpolated Strings

For strings with dynamic values, use `{placeholder}` syntax in the translation map and `fmt()` to substitute:

```js
fmt('already_exists', { term: 'hello' })
// RU: «hello» уже есть в словаре.
// EN: "hello" already exists in the vocabulary.
// SR: „hello" već postoji u rečniku.
```

### Interpolated Keys

| Key | Placeholders | Example (RU) |
|-----|-------------|--------------|
| `already_exists` | `{term}` | «hello» уже есть в словаре. |
| `word_added` | `{term}` | «hello» добавлено. |
| `word_updated` | `{term}` | «hello» обновлено. |
| `delete_confirm` | `{term}` | Удалить «hello»? |
| `words_added_result` | `{added}`, `{skipped}` | Добавлено: 5, пропущено: 2. |
| `words_all_exist` | `{count}` | Все 3 уже есть — ничего не добавлено. |

## Rules

1. **Never** hardcode UI text in mode or screen files
2. Always use `t.key_name` for simple strings
3. Always use `fmt(key, vars)` for interpolated strings
4. Always use `langLabel(lang)` for language name display
5. New strings must be added to **all 3 language maps** (ru, en, sr)
6. Use `fmtDate()` and `fmtDuration()` for localized date/time formatting
